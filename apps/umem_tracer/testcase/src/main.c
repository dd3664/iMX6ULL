/****************************************************************************************************/
/*                                           INCLUDE                                                */
/****************************************************************************************************/
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>

/****************************************************************************************************/
/*                                           DEFINES                                                */
/****************************************************************************************************/
#define TEST_SIZE        64
#define TEST_THRESH      5
/****************************************************************************************************/
/*                                           VARIABLES                                              */
/****************************************************************************************************/
static int g_count = 0;
/****************************************************************************************************/
/*                                       STATIC FUNCTIONS                                           */
/****************************************************************************************************/

/****************************************************************************************************/
/*                                       PUBLIC FUNCTIONS                                           */
/****************************************************************************************************/
void normal_leak()
{
	char *a = malloc(TEST_SIZE);
	memset(a, 0, TEST_SIZE);
	free(a);
	return;
}

void leak_malloc()
{
	char *a = malloc(TEST_SIZE);
	memset(a, 0, TEST_SIZE);
	return;
}

void bar()
{
	if (g_count++ < TEST_THRESH)
	{
		leak_malloc();
	}
	else
	{
		normal_leak();	
	}
}

void foo()
{
	bar();
	return;
}

int main(int argc, char *argv[])
{
	while (1)
	{
		foo();
		bar();
		sleep(1);
	}
	return 0;
}
